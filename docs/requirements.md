# 要件定義

## はじめに

従来はスプレッドシートで行っていた麻雀の点数記録をアプリとして開発する。

アプリ名は「じゃんスコ」とする。

## 技術スタック

- **フレームワーク**: Next.js
- **スタイル**: Tailwind CSS
- **UIライブラリ**: shadcn/ui
- **DB・認証**: Supabase
- **デザイン方針**: モバイルファースト

## 機能要件

### 点数記録の流れ

1. 参加者（3〜4人）とゲーム開始時の持ち点、レートを指定してセクションを作成する
2. ゲームが終了するたびに、各プレイヤーの点数を記録する
3. 合計点、増減、精算額（レートに基づく）、順位を表示する

### セクション管理

- セクションの作成・編集・削除
- セクションの終了（締め処理）
- 過去のセクション一覧の表示・検索・フィルタ

### ゲーム・点数管理

- ゲームごとの点数入力
- 点数の修正・削除
- 入力時のバリデーション（合計点チェック）

### 雀士管理

- 雀士の登録・編集・削除
- アカウント設定（表示名・パスワード変更）

### 統計機能

- 期間指定（全期間/月別/カスタム）
- 表示指標: 勝率、平均順位、通算収支、参加ゲーム数

## 計算ロジック

### 前提条件

| 項目   | 説明           | 例          | 備考                  |
| ---- | ------------ | ---------- | ------------------- |
| 開始点  | ゲーム開始時の持ち点   | 35,000点    |                     |
| 返し点  | 精算時の基準点      | 30,000点    | v1.0では未対応（将来的に対応検討） |
| レート  | 1,000点あたりの金額 | 50円/1,000点 |                     |
| 参加人数 | 3人または4人      | 3人         |                     |

### 計算式

```
合計点 = 各ゲームの点数の総和
増減 = 合計点 - (開始点 × ゲーム数)
精算額 = 増減 × レート / 1000
順位 = セクション内の合計点による順位（1位が最高）
```

### 端数処理

- 点数: 100点単位で記録
- 精算額: 小数点以下切り捨て

### 特殊ケース

| ケース    | 処理                                  |
| ------ | ----------------------------------- |
| 飛び（トビ） | 持ち点が0以下になった場合、そのゲームは終了。マイナス点として記録可能 |
| ウマ・オカ  | v1.0では未対応（将来的に対応検討）                 |

## 権限管理

|操作|権限|
|---|---|
|セクション作成|ログインユーザー全員|
|点数入力・修正|セクション参加者のみ|
|点数削除|セクション作成者のみ|
|雀士の作成・削除|管理者のみ|

## バリデーションルール

|項目|ルール|
|---|---|
|点数合計|参加人数 × 開始点 と一致すること|
|参加人数|3人または4人|
|点数入力|100点単位の整数|

## 非機能要件

### データ管理

- Supabaseの自動バックアップを利用
- データ保持期間: 無期限

### 同時編集

- 同一ゲームへの同時点数入力は後勝ち（Last Write Wins）
- 編集中の競合時はトースト通知で警告

### パフォーマンス

- ページ読み込み: 3秒以内
- 点数入力の反映: 1秒以内

## 従来のスプレッドシートのイメージ

||かいと|きむら|えいご||合計|
|---|---|---|---|---|---|
|1 ゲーム目|-15,000|61,000|59,000||105,000|
|2 ゲーム目|57,000|50,000|-2,000||105,000|
|3 ゲーム目|75,000|36,000|-6,000||105,000|
|4 ゲーム目|62,000|56,000|-13,000||105,000|
|5 ゲーム目|70,000|27,000|8,000||105,000|
|**合計**|249,000|230,000|46,000||525,000|
|**増減**|74,000|55,000|-129,000||0|
|**精算**|¥3,700|¥2,750|-¥6,450||¥0|
|**順位**|1|2|3|||

※ 上記例: 開始点35,000点、3人麻雀、レート50円/1,000点
